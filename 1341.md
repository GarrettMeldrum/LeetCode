with highest_movie_rating_feb as (
select
    title as 'results'
from (
    select
        m.title,
        avg(mr.rating) as 'average_rating',
        rank() over (order by avg(mr.rating) desc, m.title asc) as rnk
    from
        Movies m
    left join
        MovieRating mr on m.movie_id = mr.movie_id
    where
        mr.created_at between '2020-02-01' and '2020-02-29'
    group by
        m.title
    ) t 
where rnk = 1
),
highest_count_users as (
    SELECT name as 'results'
    FROM (
        SELECT 
            u.name,
            COUNT(mr.user_id) AS count_user_id,
            RANK() OVER (ORDER BY COUNT(mr.user_id) DESC, u.name ASC) AS rnk
        FROM 
            Users u
        left join MovieRating mr on u.user_id = mr.user_id
        GROUP BY 
            u.name
    ) t
    WHERE rnk = 1
)

select * from highest_movie_rating_feb
union all
select * from highest_count_users;
