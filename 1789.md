select e.employee_id, e.department_id
from Employee e
where (e.employee_id, e.department_id) in (
    select employee_id, department_id
	from Employee
	where employee_id not in (select employee_id from Employee where primary_flag = 'Y')
)
or (e.employee_id, e.department_id) in (
    select employee_id, department_id
    from Employee
    group by employee_id, department_id
    having sum(case when primary_flag = 'Y' then 1 else 0 end) > 0
)
